<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Events</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
      integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="../../style.css" />
  </head>
  <body class="bg-dark text-white">
    <div class="full text-center row">
      <div class="bg-purple rounded text-center col-4 offset-4">
        <h2>Liste des différents travaux</h2>
        <nav class="navbar navbar-brand">
          <a href="../../indexJS.html" class="m-1">
            <button class="btn btn-secondary">Accueil - JS</button>
          </a>
          <a href="../tp1.html" class="m-1">
            <button class="btn btn-secondary">Exo 1</button>
          </a>
          <a href="../tp2.html" class="m-1">
            <button class="btn btn-secondary">Exo 2</button>
          </a>
          <a href="./index_2.html" class="m-1">
            <button class="btn btn-secondary">Exo 3</button>
          </a>
          <a href="../../emptypage.html" class="m-1">
            <button class="btn btn-secondary">Exo 4</button>
          </a>
        </nav>
      </div>
    </div>
    <div class="text-center">
      <h1>Animated Sprite</h1>
      <canvas id="canvas" class="purple-border">
        Votre navigateur ne prend pas le canvas en charge
      </canvas>
    </div>
    <footer class="m-5 text-center">
      <p>©2020 Sterenn ROUX - IMR1 - Tous droits réservés</p>
    </footer>
  </body>
  <script>
    var fileName = "./hero_walk_cycle_spritesheet_by_mrnoobtastic-d3defej.png";

    var img = new Image();
    img.src = fileName;

    const left = 0;
    const right = 128;
    const up = 384;
    const down = 256;

    let posX = 0;
    let posY = 0;

    const spriteSize = 128;

    let direction = left;

    var canvas = document.getElementById("canvas");
    var ctx = canvas.getContext("2d");

    ctx.canvas.width = 500;
    ctx.canvas.height = 500;

    ctx.drawImage(img, 0, 0, spriteSize, spriteSize, posX, posY, spriteSize, spriteSize);

    function drawGame(index) {
      ctx.clearRect(0, 0, 50, 50);
      ctx.drawImage(
        img,
        spriteSize * index,
        direction,
        spriteSize,
        spriteSize,
        posX,
        posY,
        spriteSize,
        spriteSize
      );
    }
    var cpt = 1;
    var cptFrame = 0;

    function updateGame() {
      console.log("update game i : " + cpt);
      cptFrame++;
      if (cptFrame > 10) {
        cptFrame = 0;
        cpt++;
        if (cpt > 3) {
          cpt = 0;
        }
        switch (direction) {
          case up:
            if (posY > 0) {
              posY -= 10;
            }
            break;
          case down:
            if (posY < ctx.canvas.height - spriteSize) {
              posY += 10;
            }
            break;
          case left:
            if (posX > 0) {
              posX -= 10;
            }
            break;
          case right:
            if (posX < ctx.canvas.width - spriteSize) {
              posX += 10;
            }
            break;
        }
      }
    }

    function clearGame() {
      console.log("clear game");
      ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
    }

    var mainloop = function () {
      clearGame();
      updateGame();
      drawGame(cpt);
    };

    var animFrame =
      window.requestAnimationFrame ||
      window.webkitRequestAnimationFrame ||
      window.mozRequestAnimationFrame ||
      window.oRequestAnimationFrame ||
      window.msRequestAnimationFrame ||
      null;

    var recursiveAnim = function () {
      mainloop();
      animFrame(recursiveAnim);
    };

    // start the mainloop
    animFrame(recursiveAnim);

    window.addEventListener(
      "keydown",
      function (event) {
        if (event.defaultPrevented) {
          return; // Should do nothing if the key event was already consumed.
        }

        switch (event.key) {
          case "ArrowDown":
            // Do something for "down arrow" key press.
            direction = down;
            break;
          case "ArrowUp":
            // Do something for "up arrow" key press.
            direction = up;
            break;
          case "ArrowLeft":
            // Do something for "left arrow" key press.
            direction = left;
            break;
          case "ArrowRight":
            // Do something for "right arrow" key press.
            direction = right;
            break;
          case "Enter":
            // Do something for "enter" or "return" key press.
            //alert("Enter");
            break;
          case "Escape":
            // Do something for "esc" key press.
            //alert("Escape");
            break;
          default:
            return; // Quit when this doesn't handle the key event.
        }

        // Consume the event for suppressing "double action".
        event.preventDefault();
      },
      true
    );
  </script>
</html>
